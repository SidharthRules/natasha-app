<!DOCTYPE html>
<head>
	<title>Natasha App</title>
	<link rel="stylesheet" href="css/icon.css">
	<link rel="stylesheet" href="css/material.indigo-pink.min.css">
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	<script src="js/material.min.js"></script>
	<script src="js/jquery-2.2.4.min.js"></script>
	<script type="text/javascript" src="js/plotly-latest.min.js"></script>
	<style type="text/css">
		body{
			background-color: #f5f5f5; 
		}
		.wid90{
			width: 90%!important;
		}
		.page-content{
			padding: 10px!important;
   			}
   		@media screen and (max-width: 1024px){
   			.mdl-layout__header .mdl-layout__drawer-button {
		    margin: 7px!important;
		   }
		    #quickCommand {display: none};	
   		}
   		.mdl-button{
   			margin: 10px!important;
   		}
   		.demo-card-wide.mdl-card {
		  width: 90%;
		}
		.demo-card-wide > .mdl-card__title {
		  color: #fff;
		  height: 176px;
		  background: url('img/bg1.png') center / cover;
		}
		.demo-card-wide > .mdl-card__menu {
		  color: #fff;
		}
		.menuImg{
			width: 100px;
			padding: 10px;
		}
		.mdl-card{
			min-height: 50px;
		}
		.modebar
		{
			display: none!important;
		}
		#proDets, #save, #passChange{
			display: none;
		}
		.profile-square.mdl-card {
		  width: 280px;
		  height: 320px;
		}
		.profile-square > .mdl-card__title {
		  color: #fff;
		  background:
		    url('img/profile.png') bottom right 15% no-repeat #46B6AC;
		   background-size: 280px 280px;
		}
		.calories-square.mdl-card {
		  width: 280px;
		  height: 320px;
		}
		.calories-square > .mdl-card__title {
		  color: #fff;
		  background:
		    url('img/food.png') bottom right 15% no-repeat #46B6AC;
		  background-size: 280px 280px;
		}
		.power-square.mdl-card {
		  width: 280px;
		  height: 320px;
		}
		.power-square > .mdl-card__title {
		  color: #fff;
		  background:
		    url('img/power.png') bottom right 15% no-repeat #46B6AC;
		    background-size: 280px 280px;
		}
		.chat-square.mdl-card {
		  width: 280px;
		  height: 320px;
		}
		.chat-square > .mdl-card__title {
		  color: #fff;
		  background:
		    url('img/chat.png') bottom right 15% no-repeat #46B6AC;
		    background-size: 280px 280px;
		}
		.predicates{
			text-align: left;
		    padding: 5px;
		    margin: 5px;
		    border-radius: 2px;
		    border: 1px solid rgba(0,0,0,.1);
		}
		.predicates > a{
			color: rgba(0,0,0,.54);
		    text-transform: lowercase;
		    margin-right: 10px;
		}
		/* Style the buttons that are used to open and close the accordion panel */
		button.accordion {
		    background-color: #eee;
		    color: #444;
		    cursor: pointer;
		    padding: 18px;
		    width: 100%;
		    text-align: left;
		    border: none;
		    outline: none;
		    transition: 0.4s;
		}

		/* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
		button.accordion.active, button.accordion:hover {
		    background-color: #ddd;
		}

		/* Style the accordion panel. Note: hidden by default */
		div.panel {
		     padding: 0 18px;
		    background-color: white;
		    max-height: 0;
		    overflow: hidden;
		    transition: max-height 0.2s ease-out;
		}
		button.accordion:after {
		    content: '\02795'; /* Unicode character for "plus" sign (+) */
		    font-size: 13px;
		    color: #777;
		    float: right;
		    margin-left: 5px;
		}

		button.accordion.active:after {
		    content: "\2796"; /* Unicode character for "minus" sign (-) */
		}
		#welcome{
			background: rgba(0, 0, 0, 0.5);
			padding: 0px 10px 0px 10px;
    		border-bottom-right-radius: 10px;
		}
		#navImg
		{
			border-radius: 100%;
			width:150px;
			height: 150px;
		}
 	</style>
</head>

<body>
	<!-- Always shows a header, even in smaller screens. -->
	<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
	  <header class="mdl-layout__header">
	    <div class="mdl-layout__header-row">
	      <!-- Title -->
	      <span class="mdl-layout-title">Project Natasha</span>
	      <!-- Add spacer, to align navigation to the right -->
	      <div class="mdl-layout-spacer"></div>
	      <form action="#" id="quickCommand" onsubmit="handle">
	      	<div id="hpan" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			    <input class="mdl-textfield__input" type="text" id="ip">
			  	<label class="mdl-textfield__label" for="roll" style="color:#fff;">Command Directly From here</label>
			</div>
		  </form>
	     </div>
	  </header>
	  <div class="mdl-layout__drawer">
	    <span class="mdl-layout-title">Project Natasha</span>
	    <center><img id="navImg" class="mdl-shadow--2dp" src="img/nopicture.jpg"></center>
	    <nav class="mdl-navigation">
	      <a class="mdl-navigation__link" id="homePage">Home</a>
	      <a class="mdl-navigation__link" id="profilePage">Profile Updater</a>
	      <a class="mdl-navigation__link" id="powerPage">Power Monitor</a>
	      <a class="mdl-navigation__link" id="dietPage">Diet Monitor</a>
	      <a class="mdl-navigation__link" id="natashaPage">Settings</a>
	      <a class="mdl-navigation__link" id="logout">Logout</a>
	      <a class="mdl-navigation__link" id="navAbout">About</a>
	    </nav>
	  </div>
	  <main class="mdl-layout__content">
	    <div class="page-content">
	    	<!-- Accent-colored raised button with ripple -->
	    	<center>
	    		<div class="demo-card-wide mdl-card mdl-shadow--2dp">
				  <div class="mdl-card__title">
				    <h2 class="mdl-card__title-text" id="welcome" style="background: rgba(0, 0, 0, 0.5);"></h2>
				  </div>
				  <div class="mdl-card__supporting-text" id="myText">
				  	AI powered Smart Home Automation
				  </div>				  
				</div>

				<div class='mdl-grid mdl-card wid90 mdl-shadow--2dp' style="margin-top:10px; padding: 10px;">
					<div class="mdl-cell mdl-cell--3-col">
						<img id="profileImg" class="wid90 mdl-shadow--2dp" src="img/nopicture.jpg">
					</div>
					<div class="mdl-cell mdl-cell--9-col">
						<div class="myLoader" style="padding:10px;">
	    					<img src='img/cube.gif'/>
	    				</div>
						<div class='mdl-shadow--2dp' id='proDets'>
							  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							    <input class="mdl-textfield__input" type="text" id="name">
							    <label class="mdl-textfield__label" for="name">Your Name</label>
							  </div><br/>
							  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							    <input class="mdl-textfield__input" type="text" id="hob">
							    <label class="mdl-textfield__label" for="hob">Your Hobbies</label>
							  </div><br/>
							  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							    <input class="mdl-textfield__input" type="text" id="place">
							    <label class="mdl-textfield__label" for="place">Your Native Place</label>
							  </div><br/>
							  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							    <input class="mdl-textfield__input" type="text" id="cal">
							    <label class="mdl-textfield__label" for="cal">Per Day Calorie Consumption </label>
							  </div><br/>
							</form>
							<button id="edit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored wid90">Edit Details</button>
							<button id="save" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored wid90">Save Details</button>
							<div id='passChange'>                                                          	
								<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							      <input class="mdl-textfield__input" type="password" id="opas">
							      <label class="mdl-textfield__label" for="opas">Old Password </label>
							  	</div><br/>
							  	<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							      <input class="mdl-textfield__input" type="password" id="npas">
							      <label class="mdl-textfield__label" for="npas">New Password </label>
							  	</div><br/>
							  	<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
							      <input class="mdl-textfield__input" type="text" id="rnpas">
							      <label class="mdl-textfield__label" for="rnpas">Retype New Password </label>
							  	</div><br/>
							  	<button id="btnPass" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored wid90">Update Password </button>
							</div>
						</div>
					</div>
				</div>

				<div class="mdl-card mdl-shadow--2dp wid90" style="margin-top:10px;">
					<div class="myLoader" style="padding:10px;">
    					<img src='img/cube.gif'/>
    				</div>
    				<div class="mdl-grid wid90">
    					<div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp" id='imgSet'>
				  		</div>
				  	</div>
				  	<div class="mdl-grid wid90">
				  		<div class="mdl-cell mdl-cell--11-col" id='imgAdd'>
				  			<form id="uploadForm" method="post">
				  				<b>Your photos for face training: </b>
								<input name="userImage" type="file" class="inputFile" />
								<input name="user" id='imUser' type="hidden" />
								<script type="text/javascript">
									document.getElementById('imUser').value=localStorage.getItem('user');
								</script>
								<input type="submit" value="Submit" class="btnSubmit" />
							</form>
				  		</div>
					</div>
				</div>

				<div class="mdl-grid mdl-card wid90 mdl-shadow--2dp" style="margin-top:10px; padding: 10px;">
			 		<div class="mdl-cell mdl-cell--5-col" id='proPredicates'>
			 			<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label wid90">
					      <input class="mdl-textfield__input" type="text" id="predicate">
					      <label class="mdl-textfield__label" for="predicate">Predicate Phrase</label>
					  	</div><br/>
					  	<div class="mdl-grid" style="text-align: left;">
			 				<div class="mdl-cell mdl-cell--6-col">
			 					<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="tg_lone">
									<span class="mdl-switch__label">1st Light</span>
								  	<input type="checkbox" id="tg_lone" class="mdl-switch__input">
								</label>
								<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="tg_fone">
									<span class="mdl-switch__label">1st Fan</span>
								  	<input type="checkbox" id="tg_fone" class="mdl-switch__input">
								</label>
								<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="tg_pump">
									<span class="mdl-switch__label">Pump</span>
								  	<input type="checkbox" id="tg_pump" class="mdl-switch__input">
								</label>
			 				</div>
			 				<div class="mdl-cell mdl-cell--6-col">
			 					<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="tg_ltwo">
									<span class="mdl-switch__label">2nd Light</span>
								  	<input type="checkbox" id="tg_ltwo" class="mdl-switch__input">
								</label>
								<label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="tg_ftwo">
									<span class="mdl-switch__label">2nd Fan</span>
								  	<input type="checkbox" id="tg_ftwo" class="mdl-switch__input">
								</label>
			 				</div>
			 			</div>	
			 			<button id="btnSave" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored wid90">Save Predicate </button>
			 		</div>
			 		<div class="mdl-cell mdl-cell--7-col">
			 			<!--  -->
			 			<div  id='proPredicatesDetails'>
			 				<h4>Save your first predicate to get started.</h4>
			 			</div>
			 		</div>
			 	</div>
				 
				<div class="demo-card-wide mdl-card mdl-shadow--2dp" style="margin-top:10px;">
				 	<div class='mdl-grid'>
				 		<div class="mdl-cell mdl-cell--3-col">
			 			<div class="calories-square mdl-card mdl-shadow--2dp">
						  <div class="mdl-card__title mdl-card--expand">
						    <h2 class="mdl-card__title-text"></h2>
						  </div>
						  <div class="mdl-card__actions mdl-card--border">
						    <a id = "dietPage" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
						      DIET Monitor
						    </a>
						  </div>
						</div>
				 		</div>
				 		<div class="mdl-cell mdl-cell--3-col">
				 		<div class="profile-square mdl-card mdl-shadow--2dp">
						  <div class="mdl-card__title mdl-card--expand">
						    <h2 class="mdl-card__title-text"></h2>
						  </div>
						  <div class="mdl-card__actions mdl-card--border">
						    <a id = "profilePage" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
						      Profile Updater
						    </a>
						  </div>
						</div>
				 		</div>
				 		<div class="mdl-cell mdl-cell--3-col">
				 		<div class="power-square mdl-card mdl-shadow--2dp">
						  <div class="mdl-card__title mdl-card--expand">
						    <h2 class="mdl-card__title-text"></h2>
						  </div>
						  <div class="mdl-card__actions mdl-card--border">
						    <a id = "powerPage" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
						      Power Monitor
						    </a>
						  </div>
						</div>
				 		</div>
				 		<div class="mdl-cell mdl-cell--3-col">
				 		<div class="chat-square mdl-card mdl-shadow--2dp">
						  <div class="mdl-card__title mdl-card--expand">
						    <h2 class="mdl-card__title-text"></h2>
						  </div>
						  <div class="mdl-card__actions mdl-card--border">
						    <a id = "natashaPage" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
						      Settings
						    </a>
						  </div>
						</div>
				 		</div>
				 	</div>
				</div>
				 
				<div id="toast" class="mdl-js-snackbar mdl-snackbar">
				  <div class="mdl-snackbar__text"></div>
				  <button class="mdl-snackbar__action" type="button"></button>
				</div>
				<script type="text/javascript">
			 		//var name="",status="";
					function snack(string) {
					    var snackbarContainer = document.querySelector('#toast');
					    var data = { message: string, timeout: 2000 };
					    snackbarContainer.MaterialSnackbar.showSnackbar(data);
					}

					function pullNavImg(){
						var url="http://localhost/natasha/count.php?user="+localStorage.getItem('user');
				     	$.getJSON(url,function(result){
						   if(result.check=='True')
						   		$('#navImg').attr(
    'src',"http://localhost/natasha/images/"+localStorage.getItem('user')+"/"+result.count+".jpg");	
						   else
						   		$('#navImg').attr('src',"img/nopicture.jpg");
					 	});
					}

					function pullProImg(){
						var url="http://localhost/natasha/count.php?user="+localStorage.getItem('user');
				     	$.getJSON(url,function(result){
						   if(result.check=='True')
						   {
						   		$('#profileImg').attr(
    'src',"http://localhost/natasha/images/"+localStorage.getItem('user')+"/"+result.count+".jpg");
						   }
						   else
						   {
						   		$('#profileImg').attr('src',"img/nopicture.jpg");
						   }
						   var imgSet = document.getElementById('imgSet');
						   imgSet.innerHTML="";
						   for (i=0;i<Number(result.nos);i++)
						   		imgSet.innerHTML += "<img style='height:150px; padding:5px;' src='http://localhost/natasha/images/"+localStorage.getItem('user')+"/"+(i+1)+".jpg'/>";
					 	});
					}

					function pullProData(){
						var url="http://localhost/natasha/server/index.php?user="+localStorage.getItem('user');
					 	$.getJSON(url,function(result){
					 		if(result.check=='True')
					 		{
					 			$("#name").attr('value',result.name);
					 			$("#name").prop('disabled', true);
					 			$("#name").parent().addClass('is-dirty');

					 			$("#hob").attr('value',result.hob);
					 			$("#hob").prop('disabled', true);
					 			$("#hob").parent().addClass('is-dirty');

					 			$("#place").attr('value',result.place);
					 			$("#place").prop('disabled', true);
					 			$("#place").parent().addClass('is-dirty');

					 			$("#cal").attr('value',result.cal);
					 			$("#cal").prop('disabled', true);
					 			$("#cal").parent().addClass('is-dirty');

					 			pass=result.pass
					 		}
					 		else
					 		{
					 			snack('Failed !');
					 		}
					 		$(".myLoader").hide();
					 		$("#proDets").show();
					 	});
					}

					function delPredicate(a)
					{
						var url="http://localhost/natasha/server/index.php?delPre="+a;
						$.getJSON(url,function(result){
							if(result.check=='True')
							{
								snack('Deleted Successfully!');
								pullPredicates();
							}
							else
								snack('Deletion Failed !');
						});
					}

					function pullPredicates(){
						var url="http://localhost/natasha/server/index.php?user="+localStorage.getItem('user')+"&showPredicate";
						var block = document.getElementById('proPredicatesDetails');
						$.getJSON(url,function(result){
								if(result.length>0)
									block.innerHTML="";
							$.each(result, function(i, field){
								block.innerHTML +="<button class='accordion'>"+field.predicate+"</button><div class='panel'><p>"+"1st Light [<b>"+field.lone+"</b>], "+"1st Fan [<b>"+field.fone+"</b>], "+"2nd Light [<b>"+field.ltwo+"</b>], "+"2nd Fan [<b>"+field.ftwo+"</b>], "+"Pump [<b>"+field.pump+"</b>] "+". [<a onclick='delPredicate(\""+field.pid+"\")'>Delete</a>]</p></div>";
							});
							var acc = document.getElementsByClassName("accordion");
							var k;

							for (k = 0; k < acc.length; k++) {
							  acc[k].onclick = function() {
							    this.classList.toggle("active");
							    var panel = this.nextElementSibling;
							    if (panel.style.maxHeight){
							      panel.style.maxHeight = null;
							    } else {
							      panel.style.maxHeight = panel.scrollHeight + "px";
							    } 
							  }
							}
						});
					}

					$(document).ready(function(){
						var nos;
						pullProImg();					 
				     	var pass="";
				     	pullProData();
				     	pullPredicates();	
				     	pullNavImg();				 	

					$("#uploadForm").on('submit',(function(e) {
						e.preventDefault();
						$.ajax({
				        	url: "http://localhost/natasha/upload.php",
							type: "POST",
							data:  new FormData(this),
							contentType: false,
				    	    cache: false,
							processData:false,
							success: function(data)
						    {
						    	pullProImg();
						    	snack("Successfully Uploaded")
						    },
						  	error: function() 
					    	{
					    		snack("Failed!")
					    	} 	        
					   });
					}));
					
					$("#btnSave").click(function(){
						//Setting the value of serial switching.
						var serial = "";
						if($('#tg_lone').is(':checked'))
							serial+=1;
						else
							serial+=0;
						if($('#tg_fone').is(':checked'))
							serial+=1;
						else
							serial+=0;
						if($('#tg_ltwo').is(':checked'))
							serial+=1;
						else
							serial+=0;
						if($('#tg_ftwo').is(':checked'))
							serial+=1;
						else
							serial+=0;
						if($('#tg_pump').is(':checked'))
							serial+=1;
						else
							serial+=0;

						var url="http://localhost/natasha/server/index.php?user="+localStorage.getItem('user')+
						"&predicate="+document.getElementById('predicate').value+"&serial="+serial;
						$.getJSON(url,function(result){
							if(result.check='True')
								{
									snack('Successfully added predicate !');
									document.getElementById('predicate').value="";
									$('#predicate').parent().removeClass('is-dirty');
									pullPredicates();

								}
							else
								snack('Failed Adding !');
						});
					});

					$("#btnPass").click(function(){
						opas=document.getElementById("opas").value;
						npas=document.getElementById("npas").value;
						rnpas=document.getElementById("rnpas").value;
						if(opas==pass)
						{
							if(npas==rnpas)
							{
								var url="http://localhost/natasha/server/index.php?user="+
								localStorage.getItem('user')+"&npass="+document.getElementById("npas").value;
								$.getJSON(url,function(result){
									if(result.check=="True")
										{
											pass=npas;
											snack("Password Chaged Successfully !");
											$("#edit").show();
								 			$("#save").hide();
								 			$("#passChange").hide();
								 			$("#name").prop('disabled', true);
											$("#hob").prop('disabled', true);
											$("#place").prop('disabled', true);
											$("#cal").prop('disabled', true);
										}
								});
							}
							else
								snack('Passwords Don\'t match !');
						}
						else
							snack('Incorrect Old Password');
					});

					$("#edit").click(function(){
						$("#edit").hide();
					 	$("#save").show();
					 	$("#passChange").show();
						$("#name").prop('disabled', false);
						$("#hob").prop('disabled', false);
						$("#place").prop('disabled', false);
						$("#cal").prop('disabled', false);
						$("#cal").addClass('is-dirty');
					});
					
					$("#save").click(function(){
						var url="http://localhost/natasha/server/index.php?user="+localStorage.getItem('user')+
						"&name="+document.getElementById('name').value+"&hob="+document.getElementById('hob').value+
						"&place="+document.getElementById('place').value+"&cal="+document.getElementById('cal').value;
					 	$.getJSON(url,function(result){
					 		if(result.check=='True')
					 		{
					 			$("#edit").show();
					 			$("#save").hide();
					 			$("#passChange").hide();
					 			$("#name").prop('disabled', true);
								$("#hob").prop('disabled', true);
								$("#place").prop('disabled', true);
								$("#cal").prop('disabled', true);
					 			snack('Successfully Saved!');
					 		}
					 		else
					 		{
					 			snack('Failed to save !');
					 		}
					 	});
					});

					$("#hme").click(function(){
						var url = document.getElementById('ip').value

						$('#hme').css("display", "none");
						$('#hpan').html('<iframe style="min-height:280px;" src="'+url+'"/>');
					});
			   	
					$("#welcome").html("Welcome "+localStorage.getItem('user'));
					$("#logout").click(function(){
						localStorage.setItem("login","False");
						snack('Please Wait');
						window.open("index.html","_parent");
					});
					$("#powerPage").click(function(){
						snack('Please Wait');
						window.open("power.html","_self");
					});
					$("#profilePage").click(function(){
						snack('Please Wait');
						window.open("profile.html","_self");
					});
					$("#dietPage").click(function(){
						snack('Please Wait');
						window.open("diet.html","_self");
					});
					$("#natashaPage").click(function(){
						snack('Please Wait');
						window.open("settings.html","_self");
					});
					$("#navAbout").click(function(){
						snack('Module By S!D');
					});
				});
				</script>
	    	</center>
	    </div>
	  </main>
	</div>
</body>
</html>
